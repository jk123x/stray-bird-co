---
import { z } from "zod";
import { ProductResult } from "../data/shopify/schemas";

type ShopifyProduct = NonNullable<z.infer<typeof ProductResult>>;

export interface Props {
  product: ShopifyProduct;
}

const { product } = Astro.props;

if (!product || !product.handle) {
  return null;
}

const productName = product.title;
const firstVariant = product.variants.nodes[0];
const productPrice = firstVariant?.price.amount ?? "0";
const currencyCode = firstVariant?.price.currencyCode ?? "USD";
const productHandle = product.handle;
const featuredImage = product.featuredImage;

const formattedPrice = new Intl.NumberFormat("en-US", {
  style: "currency",
  currency: currencyCode,
}).format(parseFloat(productPrice));
---

<a
  href={`/products/${productHandle}`}
  class="group block"
>
  <div class="relative aspect-[4/5] overflow-hidden bg-zinc-100">
    {featuredImage ? (
      <img
        src={featuredImage.url}
        alt={featuredImage.altText || productName}
        width={featuredImage.width}
        height={featuredImage.height}
        class="w-full h-full object-cover transition-all duration-500 ease-out group-hover:scale-[1.02] group-hover:-translate-y-1"
        loading="lazy"
      />
    ) : (
      <div class="w-full h-full flex items-center justify-center text-zinc-400">
        No image
      </div>
    )}

    <!-- Subtle gradient overlay on hover -->
    <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />

    <!-- View product indicator -->
    <div class="absolute bottom-4 left-0 right-0 flex justify-center">
      <span class="translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300 ease-out text-white text-sm tracking-wide">
        View product
      </span>
    </div>
  </div>

  <div class="pt-4 space-y-1">
    <h3 class="text-base font-medium text-zinc-900 dark:text-white group-hover:text-zinc-600 dark:group-hover:text-zinc-300 transition-colors duration-200">
      {productName}
    </h3>
    <p class="text-sm text-zinc-500 dark:text-pink-200 group-hover:text-emerald-600 dark:group-hover:text-amber-100 transition-colors duration-300">{formattedPrice}</p>
  </div>
</a>